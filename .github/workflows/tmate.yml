name: MacOS SSH Debug with tmate

on:
  workflow_dispatch:  # Allows manual triggering

jobs:
  debug:
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install tmate
        run: |
          brew install tmate
          tmate -V  # Verify installation

      - name: Start tmate session
        id: tmate
        run: |
          # Start tmate in the background
          tmate -S /tmp/tmate.sock new-session -d

          # Wait for SSH connection string
          tmate -S /tmp/tmate.sock wait tmate-ready

          # Show SSH and Web URLs
          echo "SSH_CONNECTION=$(tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}')" >> $GITHUB_ENV
          echo "WEB_URL=$(tmate -S /tmp/tmate.sock display -p '#{tmate_web}')"

      - name: Show connection info
        run: |
          echo "Connect via SSH: $SSH_CONNECTION"
          echo "Connect via browser: $WEB_URL"

      - name: Keep session alive
        run: |
          echo "Press Ctrl+C to terminate..."
          # Keep workflow running so you can connect
          tail -f /dev/null
