name: Debug with tmate + X11 (24/7 style)

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install xauth and X11 tools
        run: |
          sudo apt-get update
          sudo apt-get install -y xauth x11-apps

      - name: Install tmate
        run: |
          sudo apt-get install -y tmate

      - name: Create Xauthority file and add key
        run: |
          touch ~/.Xauthority
          export DISPLAY=:0
          xauth add ${DISPLAY} . $(xxd -l 16 -p /dev/urandom)

      - name: Start tmate session with X11 forwarding
        run: |
          # Start a detached tmate session
          tmate -S /tmp/tmate.sock new-session -d

          # Wait for it to become available
          tmate -S /tmp/tmate.sock wait tmate-ready

          echo "SSH connection:"
          tmate -S /tmp/tmate.sock display -p '#{tmate_ssh}'

          echo "Web connection:"
          tmate -S /tmp/tmate.sock display -p '#{tmate_web}'

      - name: Keep GitHub Action alive (24/7-style)
        run: |
          echo "Keeping container alive using tail..."
          tail -f /dev/null
